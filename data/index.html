<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AstroPixels</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <h1>AstroPixels</h1>
  <div class="subtitle">R2-D2 Dome Controller</div>
  <nav>
    <a href="/" class="active">Home</a>
    <a href="/panels.html">Panels</a>
    <a href="/holos.html">Holos</a>
    <a href="/logics.html">Logics</a>
    <a href="/sequences.html">Sequences</a>
  </nav>

  <!-- Quick Actions -->
  <div class="card">
    <h3>Quick Actions</h3>
    <div class="btn-grid">
      <button class="btn accent" onclick="sendCmd(':SE01')">Scream</button>
      <button class="btn" onclick="sendCmd(':SE07')">Cantina</button>
      <button class="btn" onclick="sendCmd(':SE09')">Disco</button>
      <button class="btn" onclick="sendCmd(':SE08')">Leia</button>
      <button class="btn danger" onclick="sendCmd(':SE00')">Stop</button>
    </div>
  </div>

  <!-- Status -->
  <div class="card">
    <h3>System Status</h3>
    <div id="sys-status" style="font-size:0.85em; color:var(--text-dim);">Loading...</div>
  </div>

  <div class="status-bar" id="conn-status"><span class="dot yellow"></span>Connecting...</div>

  <script src="/app.js"></script>
  <script>
    fetchState(function(s) {
      var html = '';
      html += '<div>Uptime: ' + Math.floor(s.uptime/60) + 'm ' + (s.uptime%60) + 's</div>';
      html += '<div>Free Heap: ' + (s.freeHeap/1024).toFixed(1) + ' KB</div>';
      html += '<div>WiFi: ' + (s.wifiEnabled ? '<span class="dot green"></span>Enabled' : '<span class="dot red"></span>Disabled') + '</div>';
      if (typeof s.remoteConnected !== 'undefined') {
        html += '<div>Droid Remote: ' + (s.remoteConnected ? '<span class="dot green"></span>Connected' : '<span class="dot red"></span>Disconnected') + '</div>';
      }
      document.getElementById('sys-status').innerHTML = html;
    });
    window.onStateUpdate = function(s) {
      var html = '';
      html += '<div>Uptime: ' + Math.floor(s.uptime/60) + 'm ' + (s.uptime%60) + 's</div>';
      html += '<div>Free Heap: ' + (s.freeHeap/1024).toFixed(1) + ' KB</div>';
      html += '<div>WiFi: ' + (s.wifiEnabled ? '<span class="dot green"></span>Enabled' : '<span class="dot red"></span>Disabled') + '</div>';
      if (typeof s.remoteConnected !== 'undefined') {
        html += '<div>Droid Remote: ' + (s.remoteConnected ? '<span class="dot green"></span>Connected' : '<span class="dot red"></span>Disconnected') + '</div>';
      }
      document.getElementById('sys-status').innerHTML = html;
    };
  </script>
</body>
</html>
