<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Logics â€” AstroPixels</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/icons8-r2-d2-color-32.png?v=2">
  <link rel="shortcut icon" type="image/png" href="/icons8-r2-d2-color-32.png?v=2">
  <link rel="apple-touch-icon" sizes="192x192" href="/icons8-r2-d2-color-192.png">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <h1>Logic Displays ðŸ”µ</h1>
  <div class="subtitle">Front Logic, Rear Logic, and PSI indicators</div>
  <nav>
    <a href="/">Home</a>
    <a href="/setup.html">Setup</a>
    <a href="/panels.html">Panels</a>
    <a href="/holos.html">Holos</a>
    <a href="/logics.html" class="active">Logics</a>
    <a href="/sequences.html">Sequences</a>
  </nav>

  <!-- Quick Sequences â€” Both FLD + RLD -->
  <div class="card">
    <h3>Both Logics (FLD + RLD)</h3>
    <div class="desc">Sets both front and rear logic displays simultaneously</div>
    <div class="btn-grid mt-8">
      <button class="btn accent" onclick="sendCmd('@0T1')">Normal</button>
      <button class="btn" onclick="sendCmd('@0T2')">Flash</button>
      <button class="btn" onclick="sendCmd('@0T3')">Alarm</button>
      <button class="btn" onclick="sendCmd('@0T4')">Failure</button>
      <button class="btn danger" onclick="sendCmd('@0T5')">Scream</button>
      <button class="btn" onclick="sendCmd('@0T6')">Leia</button>
      <button class="btn" onclick="sendCmd('@0T11')">March</button>
    </div>
  </div>

  <div class="card">
    <h3>Showcase Effects</h3>
    <div class="desc">Extra ReelTwo logic effects while keeping classic Marcduino modes available</div>

    <div class="label-dim mt-8">Both</div>
    <div class="btn-grid">
      <button class="btn" title="Set front and rear logics to rainbow effect" onclick="sendCmd('@0T12')">Rainbow</button>
      <button class="btn" title="Set front and rear logics to fire effect" onclick="sendCmd('@0T22')">Fire</button>
      <button class="btn" title="Set front and rear logics to pulse effect" onclick="sendCmd('@0T24')">Pulse</button>
      <button class="btn" title="Fade both logic displays to lights-out mode" onclick="sendCmd('@0T15')">Lights Out</button>
    </div>

    <div class="label-dim mt-8">Front</div>
    <div class="btn-grid">
      <button class="btn" title="Set front logic display to rainbow effect" onclick="sendCmd('@1T12')">Rainbow</button>
      <button class="btn" title="Set front logic display to fire effect" onclick="sendCmd('@1T22')">Fire</button>
      <button class="btn" title="Set front logic display to pulse effect" onclick="sendCmd('@1T24')">Pulse</button>
      <button class="btn" title="Fade front logic display to lights-out mode" onclick="sendCmd('@1T15')">Lights Out</button>
    </div>

    <div class="label-dim mt-8">Rear</div>
    <div class="btn-grid mb-0">
      <button class="btn" title="Set rear logic display to rainbow effect" onclick="sendCmd('@2T12')">Rainbow</button>
      <button class="btn" title="Set rear logic display to fire effect" onclick="sendCmd('@2T22')">Fire</button>
      <button class="btn" title="Set rear logic display to pulse effect" onclick="sendCmd('@2T24')">Pulse</button>
      <button class="btn" title="Fade rear logic display to lights-out mode" onclick="sendCmd('@2T15')">Lights Out</button>
    </div>
  </div>

  <div class="card">
    <h3>Custom effect</h3>
    <div class="desc">Build custom AstroPixels logic effects with target, effect, color, speed, and duration controls.</div>

    <div class="label-dim mt-8">Target</div>
    <div class="btn-grid" id="aple-target-grid">
      <button class="btn is-selected" type="button" data-logic="0" onclick="setApleTarget(0, this)">Both</button>
      <button class="btn" type="button" data-logic="1" onclick="setApleTarget(1, this)">Front</button>
      <button class="btn" type="button" data-logic="2" onclick="setApleTarget(2, this)">Rear</button>
    </div>

    <div class="label-dim mt-8">Effect</div>
    <select id="aple-effect" onchange="updateAplePreview()">
      <option value="0">00 - Normal</option>
      <option value="1">01 - Alarm</option>
      <option value="2">02 - Failure</option>
      <option value="3">03 - Leia</option>
      <option value="4">04 - March</option>
      <option value="5" selected>05 - Solid Color</option>
      <option value="6">06 - Flash Color</option>
      <option value="7">07 - Flip Flop</option>
      <option value="8">08 - Flip Flop Alt</option>
      <option value="9">09 - Color Swap</option>
      <option value="10">10 - Rainbow</option>
      <option value="11">11 - Red Alert</option>
      <option value="12">12 - Mic Bright</option>
      <option value="13">13 - Mic Rainbow</option>
      <option value="14">14 - Lights Out</option>
      <option value="15">15 - Text</option>
      <option value="16">16 - Text Scroll Left</option>
      <option value="17">17 - Text Scroll Right</option>
      <option value="18">18 - Text Scroll Up</option>
      <option value="19">19 - Roaming Pixel</option>
      <option value="20">20 - Horizontal Scan</option>
      <option value="21">21 - Vertical Scan</option>
      <option value="22">22 - Fire</option>
      <option value="23">23 - PSI Color Wipe</option>
      <option value="24">24 - Pulse</option>
      <option value="99">99 - Random</option>
    </select>

    <div class="label-dim mt-8">Color</div>
    <div class="aple-color-grid" id="aple-color-grid">
      <button class="aple-color-chip is-selected" type="button" data-color="0" onclick="setApleColor(0, this)"><span class="dot" style="background:#8c98a8"></span>Default</button>
      <button class="aple-color-chip" type="button" data-color="1" onclick="setApleColor(1, this)"><span class="dot" style="background:#d94949"></span>Red</button>
      <button class="aple-color-chip" type="button" data-color="2" onclick="setApleColor(2, this)"><span class="dot" style="background:#e88f3d"></span>Orange</button>
      <button class="aple-color-chip" type="button" data-color="3" onclick="setApleColor(3, this)"><span class="dot" style="background:#dcbf3a"></span>Yellow</button>
      <button class="aple-color-chip" type="button" data-color="4" onclick="setApleColor(4, this)"><span class="dot" style="background:#3db769"></span>Green</button>
      <button class="aple-color-chip" type="button" data-color="5" onclick="setApleColor(5, this)"><span class="dot" style="background:#3dc9c4"></span>Cyan</button>
      <button class="aple-color-chip" type="button" data-color="6" onclick="setApleColor(6, this)"><span class="dot" style="background:#4e86dd"></span>Blue</button>
      <button class="aple-color-chip" type="button" data-color="7" onclick="setApleColor(7, this)"><span class="dot" style="background:#8450d9"></span>Purple</button>
      <button class="aple-color-chip" type="button" data-color="8" onclick="setApleColor(8, this)"><span class="dot" style="background:#c155d8"></span>Magenta</button>
      <button class="aple-color-chip" type="button" data-color="9" onclick="setApleColor(9, this)"><span class="dot" style="background:#d95f9b"></span>Pink</button>
    </div>

    <div class="label-dim mt-8">Speed / Sensitivity</div>
    <div class="row-10 mt-4">
      <span class="value-label">0</span>
      <input type="range" id="aple-speed" class="sound-range" min="0" max="9" value="5" oninput="document.getElementById('aple-speed-val').textContent=this.value;updateAplePreview()">
      <span class="value-label">9</span>
      <span id="aple-speed-val" class="value-label">5</span>
    </div>

    <div class="label-dim mt-8">Duration (seconds)</div>
    <div class="row-10 mt-4">
      <span class="value-label">00</span>
      <input type="range" id="aple-duration" class="sound-range" min="0" max="99" value="0" oninput="document.getElementById('aple-duration-val').textContent=pad2(this.value);updateAplePreview()">
      <span class="value-label">99</span>
      <span id="aple-duration-val" class="value-label">00</span>
    </div>

    <div class="label-dim mt-10">Command preview</div>
    <div id="aple-preview" class="desc mt-4">@APLE0050500</div>
    <div class="btn-grid mt-8 mb-0">
      <button class="btn accent" type="button" onclick="sendApleBuilderCommand()">Send Custom Effect</button>
    </div>
  </div>

  <!-- Front Logic Display -->
  <div class="card">
    <h3>Front Logic Display (FLD)</h3>
    <div class="btn-grid">
      <button class="btn accent" onclick="sendCmd('@1T1')">Normal</button>
      <button class="btn" onclick="sendCmd('@1T2')">Flash</button>
      <button class="btn" onclick="sendCmd('@1T3')">Alarm</button>
      <button class="btn" onclick="sendCmd('@1T4')">Failure</button>
      <button class="btn danger" onclick="sendCmd('@1T5')">Scream</button>
      <button class="btn" onclick="sendCmd('@1T6')">Leia</button>
      <button class="btn" onclick="sendCmd('@1T11')">March</button>
    </div>
    <div class="mt-8">
      <span class="label-dim">Scroll Text (Top half):</span>
      <div class="row mt-4">
        <input type="text" id="fld-top-text" placeholder="Enter text..." maxlength="58"
               class="flex-1">
        <button class="btn" onclick="sendCmd('@1M'+document.getElementById('fld-top-text').value)">Send</button>
      </div>
      <span class="label-dim">Scroll Text (Bottom half):</span>
      <div class="row mt-4">
        <input type="text" id="fld-bot-text" placeholder="Enter text..." maxlength="58"
               class="flex-1">
        <button class="btn" onclick="sendCmd('@2M'+document.getElementById('fld-bot-text').value)">Send</button>
      </div>
      <div class="mt-6">
        <span class="label-dim">Font:</span>
        <button class="btn" onclick="sendCmd('@1P60');sendCmd('@2P60')">Latin</button>
        <button class="btn" onclick="sendCmd('@1P61');sendCmd('@2P61')">Aurabesh</button>
      </div>
      <div class="mt-8">
        <span class="label-dim">Front scroll speed:</span>
        <div class="row-10 mt-4">
          <span class="value-label">1</span>
          <input type="range" id="fld-speed" class="sound-range" min="1" max="6" value="4"
                 oninput="document.getElementById('fld-speed-val').textContent=this.value"
                 onchange="applyFrontScrollSpeed(this.value)">
          <span class="value-label">6</span>
          <span id="fld-speed-val" class="value-label">4</span>
          <button class="btn" onclick="applyFrontScrollSpeed(document.getElementById('fld-speed').value)">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rear Logic Display -->
  <div class="card">
    <h3>Rear Logic Display (RLD)</h3>
    <div class="btn-grid">
      <button class="btn accent" onclick="sendCmd('@2T1')">Normal</button>
      <button class="btn" onclick="sendCmd('@2T2')">Flash</button>
      <button class="btn" onclick="sendCmd('@2T3')">Alarm</button>
      <button class="btn" onclick="sendCmd('@2T4')">Failure</button>
      <button class="btn danger" onclick="sendCmd('@2T5')">Scream</button>
      <button class="btn" onclick="sendCmd('@2T6')">Leia</button>
      <button class="btn" onclick="sendCmd('@2T11')">March</button>
    </div>
    <div class="mt-8">
      <span class="label-dim">Scroll Text:</span>
      <div class="row mt-4">
        <input type="text" id="rld-text" placeholder="Enter text..." maxlength="60"
               class="flex-1">
        <button class="btn" onclick="sendCmd('@3M'+document.getElementById('rld-text').value)">Send</button>
      </div>
      <div class="mt-6">
        <span class="label-dim">Font:</span>
        <button class="btn" onclick="sendCmd('@3P60')">Latin</button>
        <button class="btn" onclick="sendCmd('@3P61')">Aurabesh</button>
      </div>
      <div class="mt-8">
        <span class="label-dim">Rear scroll speed:</span>
        <div class="row-10 mt-4">
          <span class="value-label">1</span>
          <input type="range" id="rld-speed" class="sound-range" min="1" max="6" value="4"
                 oninput="document.getElementById('rld-speed-val').textContent=this.value"
                 onchange="applyRearScrollSpeed(this.value)">
          <span class="value-label">6</span>
          <span id="rld-speed-val" class="value-label">4</span>
          <button class="btn" onclick="applyRearScrollSpeed(document.getElementById('rld-speed').value)">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PSI Indicators -->
  <div class="card">
    <h3>PSI Indicators</h3>
    <div class="desc">Process State Indicators (front and rear)</div>

    <div class="label-dim mt-8">Both</div>
    <div class="btn-grid">
      <button class="btn" title="Normal" onclick="sendCmd('@0P1')">Normal</button>
      <button class="btn" title="Flash" onclick="sendCmd('@0P2')">Flash</button>
      <button class="btn" title="Alarm" onclick="sendCmd('@0P3')">Alarm</button>
      <button class="btn" title="Fail" onclick="sendCmd('@0P4')">Fail</button>
      <button class="btn danger" title="Scream" onclick="sendCmd('@0P5')">Scream</button>
      <button class="btn" title="Leia" onclick="sendCmd('@0P6')">Leia</button>
      <button class="btn" title="March" onclick="sendCmd('@0P11')">March</button>
    </div>

    <div class="label-dim mt-8">Front</div>
    <div class="btn-grid">
      <button class="btn" title="Normal" onclick="sendCmd('@1P1')">Normal</button>
      <button class="btn" title="Flash" onclick="sendCmd('@1P2')">Flash</button>
      <button class="btn" title="Alarm" onclick="sendCmd('@1P3')">Alarm</button>
      <button class="btn" title="Fail" onclick="sendCmd('@1P4')">Fail</button>
      <button class="btn danger" title="Scream" onclick="sendCmd('@1P5')">Scream</button>
      <button class="btn" title="Leia" onclick="sendCmd('@1P6')">Leia</button>
      <button class="btn" title="March" onclick="sendCmd('@1P11')">March</button>
    </div>

    <div class="label-dim mt-8">Rear</div>
    <div class="btn-grid mb-0">
      <button class="btn" title="Normal" onclick="sendCmd('@2P1')">Normal</button>
      <button class="btn" title="Flash" onclick="sendCmd('@2P2')">Flash</button>
      <button class="btn" title="Alarm" onclick="sendCmd('@2P3')">Alarm</button>
      <button class="btn" title="Fail" onclick="sendCmd('@2P4')">Fail</button>
      <button class="btn danger" title="Scream" onclick="sendCmd('@2P5')">Scream</button>
      <button class="btn" title="Leia" onclick="sendCmd('@2P6')">Leia</button>
      <button class="btn" title="March" onclick="sendCmd('@2P11')">March</button>
    </div>
  </div>

  <div class="status-bar" id="conn-status"><span class="dot yellow"></span>Connecting...</div>
  <script src="/app.js"></script>
  <script>
    var apleBuilderState = {
      logic: 0,
      color: 0
    };

    function pad2(v) {
      var n = parseInt(v, 10);
      if (!isFinite(n)) n = 0;
      if (n < 0) n = 0;
      if (n > 99) n = 99;
      return n < 10 ? ('0' + n) : String(n);
    }

    function clampDigit(v) {
      var n = parseInt(v, 10);
      if (!isFinite(n)) return 0;
      if (n < 0) return 0;
      if (n > 9) return 9;
      return n;
    }

    function setApleTarget(logic, el) {
      apleBuilderState.logic = clampDigit(logic);
      var buttons = document.querySelectorAll('#aple-target-grid .btn');
      for (var i = 0; i < buttons.length; i++) {
        buttons[i].classList.remove('is-selected');
      }
      if (el && el.classList) el.classList.add('is-selected');
      updateAplePreview();
    }

    function setApleColor(color, el) {
      apleBuilderState.color = clampDigit(color);
      var chips = document.querySelectorAll('#aple-color-grid .aple-color-chip');
      for (var i = 0; i < chips.length; i++) {
        chips[i].classList.remove('is-selected');
      }
      if (el && el.classList) el.classList.add('is-selected');
      updateAplePreview();
    }

    function getApleBuilderCommand() {
      var effect = parseInt(document.getElementById('aple-effect').value, 10);
      if (!isFinite(effect) || effect < 0) effect = 0;
      if (effect > 99) effect = 99;
      var speed = clampDigit(document.getElementById('aple-speed').value);
      var duration = parseInt(document.getElementById('aple-duration').value, 10);
      if (!isFinite(duration) || duration < 0) duration = 0;
      if (duration > 99) duration = 99;

      return '@APLE' + apleBuilderState.logic + pad2(effect) + apleBuilderState.color + speed + pad2(duration);
    }

    function updateAplePreview() {
      var preview = document.getElementById('aple-preview');
      if (!preview) return;
      preview.textContent = getApleBuilderCommand();
    }

    function sendApleBuilderCommand() {
      sendCmd(getApleBuilderCommand());
      updateAplePreview();
    }

    function clampScrollSpeed(v) {
      var n = parseInt(v, 10);
      if (!isFinite(n)) return 4;
      if (n < 1) return 1;
      if (n > 6) return 6;
      return n;
    }

    function applyFrontScrollSpeed(v) {
      var speed = clampScrollSpeed(v);
      sendCmd('@1G' + speed);
      sendCmd('@2G' + speed);
    }

    function applyRearScrollSpeed(v) {
      var speed = clampScrollSpeed(v);
      sendCmd('@3G' + speed);
    }

    updateAplePreview();
  </script>
</body>
</html>
